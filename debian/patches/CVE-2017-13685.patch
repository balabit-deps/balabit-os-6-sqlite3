Backported of:

Description: Backport changes to shell.c into shell.c.in.
Origin:  https://www.sqlite.org/src/info/2348045fbc3fc99e
Bug-Debian: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=873762
diff --git a/src/shell.c b/src/shell.c
index 85e36a8..fb56b7a 100644
--- a/src/shell.c
+++ b/src/shell.c
@@ -884,6 +884,7 @@ static int shell_callback(
   int i;
   ShellState *p = (ShellState*)pArg;
 
+  if( azArg==0 ) return 0;
   switch( p->cMode ){
     case MODE_Line: {
       int w = 5;
@@ -1773,7 +1774,7 @@ static int dump_callback(void *pArg, int nArg, char **azArg, char **azCol){
   ShellState *p = (ShellState *)pArg;
 
   UNUSED_PARAMETER(azCol);
-  if( nArg!=3 ) return 1;
+  if( nArg!=3 || azArg==0 ) return 0;
   zTable = azArg[0];
   zType = azArg[1];
   zSql = azArg[2];
@@ -4667,7 +4668,7 @@ int SQLITE_CDECL main(int argc, char **argv){
   char **azCmd = 0;
 
 #if USE_SYSTEM_SQLITE+0!=1
-  if( strcmp(sqlite3_sourceid(),SQLITE_SOURCE_ID)!=0 ){
+  if( strncmp(sqlite3_sourceid(),SQLITE_SOURCE_ID,60)!=0 ){
     utf8_printf(stderr, "SQLite header and source version mismatch\n%s\n%s\n",
             sqlite3_sourceid(), SQLITE_SOURCE_ID);
     exit(1);
