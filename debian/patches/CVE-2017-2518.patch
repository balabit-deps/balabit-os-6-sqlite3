Description: Prevent a possible use-after-free bug in the query optimizer.
Origin: https://www.sqlite.org/src/info/0a98c8d76ac86412
Bug-Debian: 867618 893195
Index: sqlite3-3.11.0/src/whereexpr.c
===================================================================
--- sqlite3-3.11.0.orig/src/whereexpr.c
+++ sqlite3-3.11.0/src/whereexpr.c
@@ -1191,6 +1191,8 @@ static void exprAnalyze(
   /* Prevent ON clause terms of a LEFT JOIN from being used to drive
   ** an index for tables to the left of the join.
   */
+  testcase( pTerm!=&pWC->a[idxTerm] );
+  pTerm = &pWC->a[idxTerm];
   pTerm->prereqRight |= extraRight;
 }
 
